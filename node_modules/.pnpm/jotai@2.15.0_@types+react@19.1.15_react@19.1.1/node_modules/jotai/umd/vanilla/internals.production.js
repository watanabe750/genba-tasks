!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((n="undefined"!=typeof globalThis?globalThis:n||self).jotaiVanillaInternals={})}(this,function(n){"use strict";function e(n,e){(null==e||e>n.length)&&(e=n.length);for(var r=0,t=Array(e);r<e;r++)t[r]=n[r];return t}function r(n,r){var t="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(t)return(t=t.call(n)).next.bind(t);if(Array.isArray(n)||(t=function(n,r){if(n){if("string"==typeof n)return e(n,r);var t={}.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(n):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?e(n,r):void 0}}(n))||r){t&&(n=t);var a=0;return function(){return a>=n.length?{done:!0}:{done:!1,value:n[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function t(n){return"init"in n}function a(n){return!!n.write}function o(n){return"v"in n||"e"in n}function i(n){if("e"in n)throw n.e;return n.v}var u=new WeakMap;function l(n){var e;return c(n)&&!(null==(e=u.get(n))||!e[0])}function f(n){var e=u.get(n);null!=e&&e[0]&&(e[0]=!1,e[1].forEach(function(n){return n()}))}function d(n,e){var r=u.get(n);if(!r){r=[!0,new Set],u.set(n,r);var t=function(){r[0]=!1};n.then(t,t)}r[1].add(e)}function c(n){return"function"==typeof(null==n?void 0:n.then)}function v(n,e,r){if(!r.p.has(n)){r.p.add(n);var t=function(){return r.p.delete(n)};e.then(t,t)}}function s(n,e,t){for(var a,o=new Set,i=r((null==(u=t.get(n))?void 0:u.t)||[]);!(a=i()).done;){var u,l=a.value;t.has(l)&&o.add(l)}for(var f,d=r(e.p);!(f=d()).done;){var c=f.value;o.add(c)}return o}var y=function(){var n={},e=new WeakMap,r=function(r){var t,a;null==(t=e.get(n))||t.forEach(function(n){return n(r)}),null==(a=e.get(r))||a.forEach(function(n){return n()})};return r.add=function(r,t){var a=r||n,o=(e.has(a)?e:e.set(a,new Set)).get(a);return o.add(t),function(){null==o||o.delete(t),o.size||e.delete(a)}},r};var h=function(n,e){for(var r=arguments.length,t=new Array(r>2?r-2:0),a=2;a<r;a++)t[a-2]=arguments[a];return e.read.apply(e,t)},p=function(n,e){for(var r=arguments.length,t=new Array(r>2?r-2:0),a=2;a<r;a++)t[a-2]=arguments[a];return e.write.apply(e,t)},g=function(n,e){return null==e.unstable_onInit?void 0:e.unstable_onInit(n)},w=function(n,e,r){return null==e.onMount?void 0:e.onMount(r)},A=function(n,e){var r=W(n),t=r[0],a=r[9],o=t.get(e);return o||(o={d:new Map,p:new Set,n:0},t.set(e,o),null==a||a(n,e)),o},m=function(n){var e=W(n),r=e[1],t=e[3],a=e[4],o=e[5],i=e[6],u=e[13],l=[],f=function(n){try{n()}catch(n){l.push(n)}},d=function(){i.f&&f(i.f);var e=new Set,l=e.add.bind(e);t.forEach(function(n){var e;return null==(e=r.get(n))?void 0:e.l.forEach(l)}),t.clear(),o.forEach(l),o.clear(),a.forEach(l),a.clear(),e.forEach(f),t.size&&u(n)};do{d()}while(t.size||o.size||a.size);if(l.length)throw new AggregateError(l)},N=function(n){for(var e=W(n),t=e[1],a=e[2],o=e[3],i=e[11],u=e[14],l=e[17],f=[],d=new WeakSet,c=new WeakSet,v=Array.from(o);v.length;){var y=v[v.length-1],h=i(n,y);if(c.has(y))v.pop();else if(d.has(y))a.get(y)===h.n&&f.push([y,h]),c.add(y),v.pop();else{d.add(y);for(var p,g=r(s(y,h,t));!(p=g()).done;){var w=p.value;d.has(w)||v.push(w)}}}for(var A=f.length-1;A>=0;--A){for(var m,N=f[A],E=N[0],b=!1,S=r(N[1].d.keys());!(m=S()).done;){var I=m.value;if(I!==E&&o.has(I)){b=!0;break}}b&&(u(n,E),l(n,E)),a.delete(E)}},E=function(n,e){var r=W(n),u=r[1],f=r[2],s=r[3],y=r[6],h=r[7],p=r[11],g=r[12],w=r[13],A=r[14],m=r[16],N=r[17],E=p(n,e);if(o(E)){if(u.has(e)&&f.get(e)!==E.n)return E;if(Array.from(E.d).every(function(e){var r=e[0],t=e[1];return A(n,r).n===t}))return E}E.d.clear();var b,S,I=!0;function T(){u.has(e)&&(N(n,e),w(n),g(n))}var k={get signal(){return b||(b=new AbortController),b.signal},get setSelf(){return!S&&a(e)&&(S=function(){if(!I)try{for(var r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];return m.apply(void 0,[n,e].concat(t))}finally{w(n),g(n)}}),S}},_=E.n;try{var L=h(n,e,function(r){if(r===e){var a=p(n,r);if(!o(a)){if(!t(r))throw new Error("no atom init");R(n,r,r.init)}return i(a)}var f=A(n,r);try{return i(f)}finally{var d;E.d.set(r,f.n),l(E.v)&&v(e,E.v,f),null==(d=u.get(r))||d.t.add(e),I||T()}},k);return R(n,e,L),c(L)&&(d(L,function(){var n;return null==(n=b)?void 0:n.abort()}),L.then(T,T)),null==y.r||y.r(e),E}catch(n){return delete E.v,E.e=n,++E.n,E}finally{I=!1,_!==E.n&&f.get(e)===_&&(f.set(e,E.n),s.add(e),null==y.c||y.c(e))}},b=function(n,e){for(var t=W(n),a=t[1],o=t[2],i=t[11],u=[e];u.length;)for(var l,f=u.pop(),d=r(s(f,i(n,f),a));!(l=d()).done;){var c=l.value,v=i(n,c);o.set(c,v.n),u.push(c)}},S=function(n,e){var r=W(n),a=r[3],o=r[6],u=r[8],l=r[11],f=r[12],d=r[13],c=r[14],v=r[15],s=r[17],y=!0;try{for(var h=arguments.length,p=new Array(h>2?h-2:0),g=2;g<h;g++)p[g-2]=arguments[g];return u.apply(void 0,[n,e,function(e){return i(c(n,e))},function(r){var i=l(n,r);try{for(var u=arguments.length,c=new Array(u>1?u-1:0),h=1;h<u;h++)c[h-1]=arguments[h];if(r===e){if(!t(r))throw new Error("atom not writable");var p=i.n,g=c[0];return R(n,r,g),s(n,r),void(p!==i.n&&(a.add(r),null==o.c||o.c(r),v(n,r)))}return S.apply(void 0,[n,r].concat(c))}finally{y||(d(n),f(n))}}].concat(p))}finally{y=!1}},I=function(n,e){var t=W(n),a=t[1],o=t[3],i=t[6],u=t[11],f=t[15],d=t[18],c=t[19],v=u(n,e),s=a.get(e);if(s&&!l(v.v)){for(var y,h=r(v.d);!(y=h()).done;){var p=y.value,g=p[0],w=p[1];if(!s.d.has(g)){var A=u(n,g);d(n,g).t.add(e),s.d.add(g),w!==A.n&&(o.add(g),null==i.c||i.c(g),f(n,g))}}for(var m,N=r(s.d||[]);!(m=N()).done;){var E=m.value;if(!v.d.has(E)){s.d.delete(E);var b=c(n,E);null==b||b.t.delete(e)}}}},T=function(n,e){var t=W(n),o=t[1],i=t[4],u=t[6],l=t[10],f=t[11],d=t[12],c=t[13],v=t[14],s=t[16],y=f(n,e),h=o.get(e);if(!h){v(n,e);for(var p,g=r(y.d.keys());!(p=g()).done;){var w=p.value;T(n,w).t.add(e)}if(h={l:new Set,d:new Set(y.d.keys()),t:new Set},o.set(e,h),null==u.m||u.m(e),a(e)){i.add(function(){var r=!0;try{var t=l(n,e,function(){try{for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return s.apply(void 0,[n,e].concat(a))}finally{r||(c(n),d(n))}});t&&(h.u=function(){r=!0;try{t()}finally{r=!1}})}finally{r=!1}})}}return h},k=function(n,e){var t=W(n),a=t[1],o=t[5],i=t[6],u=t[11],l=t[19],f=u(n,e),d=a.get(e);if(!d||d.l.size||Array.from(d.t).some(function(n){var r;return null==(r=a.get(n))?void 0:r.d.has(e)}))return d;d.u&&o.add(d.u),d=void 0,a.delete(e),null==i.u||i.u(e);for(var c,v=r(f.d.keys());!(c=v()).done;){var s=l(n,c.value);null==s||s.t.delete(e)}},R=function(n,e,t){var a=W(n)[11],o=a(n,e),i="v"in o,u=o.v;if(c(t))for(var l,d=r(o.d.keys());!(l=d()).done;){v(e,t,a(n,l.value))}o.v=t,delete o.e,i&&Object.is(u,o.v)||(++o.n,c(u)&&f(u))},_=function(n,e){return i((0,W(n)[14])(n,e))},L=function(n,e){var r=W(n),t=r[12],a=r[13],o=r[16];try{for(var i=arguments.length,u=new Array(i>2?i-2:0),l=2;l<i;l++)u[l-2]=arguments[l];return o.apply(void 0,[n,e].concat(u))}finally{a(n),t(n)}},M=function(n,e,r){var t=W(n),a=t[12],o=t[18],i=t[19],u=o(n,e).l;return u.add(r),a(n),function(){u.delete(r),i(n,e),a(n)}},z=new WeakMap,W=function(n){return z.get(n)};n.INTERNAL_abortPromise=f,n.INTERNAL_addPendingPromiseToDependency=v,n.INTERNAL_buildStoreRev2=function(){for(var n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];var t={get:function(n){return(0,W(t)[21])(t,n)},set:function(n){for(var e=W(t)[22],r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];return e.apply(void 0,[t,n].concat(a))},sub:function(n,e){return(0,W(t)[23])(t,n,e)}},a=[new WeakMap,new WeakMap,new WeakMap,new Set,new Set,new Set,{},h,p,g,w,A,m,N,E,b,S,I,T,k,R,_,L,M,void 0].map(function(n,r){return e[r]||n});return z.set(t,Object.freeze(a)),t},n.INTERNAL_getBuildingBlocksRev2=function(n){var e=W(n),r=e[24];return r?r(e):e},n.INTERNAL_getMountedOrPendingDependents=s,n.INTERNAL_hasInitialValue=t,n.INTERNAL_initializeStoreHooksRev2=function(n){var e,r,t,a,o,i,u;return(e=n).r||(e.r=y()),(r=n).c||(r.c=y()),(t=n).m||(t.m=y()),(a=n).u||(a.u=y()),(o=n).f||(o.f=(i=new Set,(u=function(){return i.forEach(function(n){return n()})}).add=function(n){return i.add(n),function(){return i.delete(n)}},u)),n},n.INTERNAL_isActuallyWritableAtom=a,n.INTERNAL_isAtomStateInitialized=o,n.INTERNAL_isPendingPromise=l,n.INTERNAL_isPromiseLike=c,n.INTERNAL_promiseStateMap=u,n.INTERNAL_registerAbortHandler=d,n.INTERNAL_returnAtomValue=i});
